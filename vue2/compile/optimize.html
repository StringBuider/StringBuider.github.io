<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>optimize | å°å¼ çš„å…±äº«æ–‡æ¡£</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="ğŸ¤”ä½ æœ‰ä»€ä¹ˆæƒ³è¯´ï¼Ÿå†™è¿›æ¥å§ï¼ğŸ˜">
    
    <link rel="preload" href="./assets/css/0.styles.a246c231.css" as="style"><link rel="preload" href="./assets/js/app.c50cae2e.js" as="script"><link rel="preload" href="./assets/js/4.08095b6d.js" as="script"><link rel="preload" href="./assets/js/33.e00e1922.js" as="script"><link rel="prefetch" href="./assets/js/10.ed3e9f33.js"><link rel="prefetch" href="./assets/js/11.6495f8ce.js"><link rel="prefetch" href="./assets/js/12.e15e40c1.js"><link rel="prefetch" href="./assets/js/13.33a2b3c3.js"><link rel="prefetch" href="./assets/js/14.5d605ae8.js"><link rel="prefetch" href="./assets/js/15.b5e3a30f.js"><link rel="prefetch" href="./assets/js/16.32bee43d.js"><link rel="prefetch" href="./assets/js/17.67f7f069.js"><link rel="prefetch" href="./assets/js/18.af04d610.js"><link rel="prefetch" href="./assets/js/19.730c3139.js"><link rel="prefetch" href="./assets/js/2.7fc48c46.js"><link rel="prefetch" href="./assets/js/20.1c4fbbf9.js"><link rel="prefetch" href="./assets/js/21.67119724.js"><link rel="prefetch" href="./assets/js/22.c2076f14.js"><link rel="prefetch" href="./assets/js/23.f25b155f.js"><link rel="prefetch" href="./assets/js/24.c8791672.js"><link rel="prefetch" href="./assets/js/25.af22f7f1.js"><link rel="prefetch" href="./assets/js/26.777a42b7.js"><link rel="prefetch" href="./assets/js/27.25c6658f.js"><link rel="prefetch" href="./assets/js/28.4c66a1fb.js"><link rel="prefetch" href="./assets/js/29.45d218cd.js"><link rel="prefetch" href="./assets/js/3.fb9770df.js"><link rel="prefetch" href="./assets/js/30.2cfa5f3d.js"><link rel="prefetch" href="./assets/js/31.9a7819c6.js"><link rel="prefetch" href="./assets/js/32.6b80cecb.js"><link rel="prefetch" href="./assets/js/34.445fb4ff.js"><link rel="prefetch" href="./assets/js/35.2f86d553.js"><link rel="prefetch" href="./assets/js/36.7e8dc342.js"><link rel="prefetch" href="./assets/js/37.827964ca.js"><link rel="prefetch" href="./assets/js/38.306618b3.js"><link rel="prefetch" href="./assets/js/39.96d345b4.js"><link rel="prefetch" href="./assets/js/40.5327dcb2.js"><link rel="prefetch" href="./assets/js/41.29160afa.js"><link rel="prefetch" href="./assets/js/42.3ec42885.js"><link rel="prefetch" href="./assets/js/43.db7bc261.js"><link rel="prefetch" href="./assets/js/44.60eae751.js"><link rel="prefetch" href="./assets/js/45.15437d11.js"><link rel="prefetch" href="./assets/js/46.55a5744d.js"><link rel="prefetch" href="./assets/js/47.e8e54de1.js"><link rel="prefetch" href="./assets/js/48.97e52f5e.js"><link rel="prefetch" href="./assets/js/49.c58d43a4.js"><link rel="prefetch" href="./assets/js/5.4c884eba.js"><link rel="prefetch" href="./assets/js/50.a93fcdb0.js"><link rel="prefetch" href="./assets/js/51.c43da0f8.js"><link rel="prefetch" href="./assets/js/52.e0cc02e1.js"><link rel="prefetch" href="./assets/js/53.95f0f53a.js"><link rel="prefetch" href="./assets/js/54.c4c47eaf.js"><link rel="prefetch" href="./assets/js/55.b37c9037.js"><link rel="prefetch" href="./assets/js/56.3d8ed2b4.js"><link rel="prefetch" href="./assets/js/57.bd65c07b.js"><link rel="prefetch" href="./assets/js/58.134b9e82.js"><link rel="prefetch" href="./assets/js/59.24c871f7.js"><link rel="prefetch" href="./assets/js/6.4e374fac.js"><link rel="prefetch" href="./assets/js/60.b75523ad.js"><link rel="prefetch" href="./assets/js/61.484be178.js"><link rel="prefetch" href="./assets/js/62.180c4d5d.js"><link rel="prefetch" href="./assets/js/63.c4c8b737.js"><link rel="prefetch" href="./assets/js/64.3921bee2.js"><link rel="prefetch" href="./assets/js/65.8c31bc75.js"><link rel="prefetch" href="./assets/js/66.a5410547.js"><link rel="prefetch" href="./assets/js/67.32e09623.js"><link rel="prefetch" href="./assets/js/68.4d59d330.js"><link rel="prefetch" href="./assets/js/69.fffc95ef.js"><link rel="prefetch" href="./assets/js/7.ef54b1c1.js"><link rel="prefetch" href="./assets/js/70.72980d01.js"><link rel="prefetch" href="./assets/js/71.fbafa4c6.js"><link rel="prefetch" href="./assets/js/72.59e84ead.js"><link rel="prefetch" href="./assets/js/73.62c6073a.js"><link rel="prefetch" href="./assets/js/74.098849aa.js"><link rel="prefetch" href="./assets/js/75.c4126dcd.js"><link rel="prefetch" href="./assets/js/76.288ce637.js"><link rel="prefetch" href="./assets/js/77.405cc8e4.js"><link rel="prefetch" href="./assets/js/78.f092ec42.js"><link rel="prefetch" href="./assets/js/79.5965beb6.js"><link rel="prefetch" href="./assets/js/8.1e8a08c7.js"><link rel="prefetch" href="./assets/js/80.b06d3623.js"><link rel="prefetch" href="./assets/js/81.7e1c12fd.js"><link rel="prefetch" href="./assets/js/82.23093c7e.js"><link rel="prefetch" href="./assets/js/9.07409efc.js">
    <link rel="stylesheet" href="./assets/css/0.styles.a246c231.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">å°å¼ çš„å…±äº«æ–‡æ¡£</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æŒ‡å—" class="dropdown-title"><span class="title">æŒ‡å—</span> <span class="arrow down"></span></button> <button type="button" aria-label="æŒ‡å—" class="mobile-dropdown-title"><span class="title">æŒ‡å—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./guide/getting-started.html" class="nav-link">
  å‚ä¸å†™ä½œ
</a></li><li class="dropdown-item"><!----> <a href="/./guide/micro-frontends.html" class="nav-link">
  å¾®å‰ç«¯
</a></li><li class="dropdown-item"><!----> <a href="/./guide/micro-frontends-faq.html" class="nav-link">
  å¾®å‰ç«¯FAQ
</a></li><li class="dropdown-item"><!----> <a href="/./guide/git-flow.html" class="nav-link">
  å·¥ä½œæµ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è§„èŒƒ" class="dropdown-title"><span class="title">è§„èŒƒ</span> <span class="arrow down"></span></button> <button type="button" aria-label="è§„èŒƒ" class="mobile-dropdown-title"><span class="title">è§„èŒƒ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./standard/micro-frontends-route.html" class="nav-link">
  å¾®å‰ç«¯-è·¯ç”±è§„èŒƒ
</a></li><li class="dropdown-item"><!----> <a href="/./standard/micro-frontends-version-control.html" class="nav-link">
  å¾®å‰ç«¯-ç‰ˆæœ¬ç®¡ç†
</a></li><li class="dropdown-item"><!----> <a href="/./standard/typescript.html" class="nav-link">
  TypeScriptè§„èŒƒ
</a></li><li class="dropdown-item"><!----> <a href="/./standard/code-version-control.html" class="nav-link">
  ä»£ç åˆ†æ”¯ç®¡ç†
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="tips" class="dropdown-title"><span class="title">tips</span> <span class="arrow down"></span></button> <button type="button" aria-label="tips" class="mobile-dropdown-title"><span class="title">tips</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./tips/url-mode.html" class="nav-link">
  urlæ¨¡å¼
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ’ä»¶" class="dropdown-title"><span class="title">æ’ä»¶</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ’ä»¶" class="mobile-dropdown-title"><span class="title">æ’ä»¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./plugins/plugin.html" class="nav-link">
  æ’ä»¶åˆ†äº«
</a></li></ul></div></div><div class="nav-item"><a href="/./vue2/prepare/" class="nav-link">
  vue2.x
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue3.x" class="dropdown-title"><span class="title">vue3.x</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue3.x" class="mobile-dropdown-title"><span class="title">vue3.x</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./vue3/essence-of-comp.html" class="nav-link">
  ç»„ä»¶çš„æœ¬è´¨
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/vnode.html" class="nav-link">
  æŠŠVNodeè§£å‰–ä¸€ä¸‹
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/h.html" class="nav-link">
  è¾…åŠ©åˆ›å»º VNode çš„ h å‡½æ•°
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/observer.html" class="nav-link">
  å“åº”å¼åŸç†
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/renderer.html" class="nav-link">
  æ¸²æŸ“å™¨ä¹‹æŒ‚è½½
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/renderer-patch.html" class="nav-link">
  æ¸²æŸ“å™¨ä¹‹patch
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/renderer-diff.html" class="nav-link">
  æ¸²æŸ“å™¨çš„æ ¸å¿ƒ Diff ç®—æ³•
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/renderer-advanced.html" class="nav-link">
  è‡ªå®šä¹‰æ¸²æŸ“å™¨
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯å…«è‚¡æ–‡" class="dropdown-title"><span class="title">å‰ç«¯å…«è‚¡æ–‡</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯å…«è‚¡æ–‡" class="mobile-dropdown-title"><span class="title">å‰ç«¯å…«è‚¡æ–‡</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./basic/basic.html" class="nav-link">
  å…«è‚¡æ–‡
</a></li><li class="dropdown-item"><!----> <a href="/./basic/arithmetic.html" class="nav-link">
  ç®—æ³•
</a></li><li class="dropdown-item"><!----> <a href="/./basic/desinmode.html" class="nav-link">
  è®¾è®¡æ¨¡å¼
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¢è¯•ç»éªŒ" class="dropdown-title"><span class="title">é¢è¯•ç»éªŒ</span> <span class="arrow down"></span></button> <button type="button" aria-label="é¢è¯•ç»éªŒ" class="mobile-dropdown-title"><span class="title">é¢è¯•ç»éªŒ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./interview/interview.html" class="nav-link">
  é¢è¯•ç»éªŒ
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/./" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æŒ‡å—" class="dropdown-title"><span class="title">æŒ‡å—</span> <span class="arrow down"></span></button> <button type="button" aria-label="æŒ‡å—" class="mobile-dropdown-title"><span class="title">æŒ‡å—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./guide/getting-started.html" class="nav-link">
  å‚ä¸å†™ä½œ
</a></li><li class="dropdown-item"><!----> <a href="/./guide/micro-frontends.html" class="nav-link">
  å¾®å‰ç«¯
</a></li><li class="dropdown-item"><!----> <a href="/./guide/micro-frontends-faq.html" class="nav-link">
  å¾®å‰ç«¯FAQ
</a></li><li class="dropdown-item"><!----> <a href="/./guide/git-flow.html" class="nav-link">
  å·¥ä½œæµ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è§„èŒƒ" class="dropdown-title"><span class="title">è§„èŒƒ</span> <span class="arrow down"></span></button> <button type="button" aria-label="è§„èŒƒ" class="mobile-dropdown-title"><span class="title">è§„èŒƒ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./standard/micro-frontends-route.html" class="nav-link">
  å¾®å‰ç«¯-è·¯ç”±è§„èŒƒ
</a></li><li class="dropdown-item"><!----> <a href="/./standard/micro-frontends-version-control.html" class="nav-link">
  å¾®å‰ç«¯-ç‰ˆæœ¬ç®¡ç†
</a></li><li class="dropdown-item"><!----> <a href="/./standard/typescript.html" class="nav-link">
  TypeScriptè§„èŒƒ
</a></li><li class="dropdown-item"><!----> <a href="/./standard/code-version-control.html" class="nav-link">
  ä»£ç åˆ†æ”¯ç®¡ç†
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="tips" class="dropdown-title"><span class="title">tips</span> <span class="arrow down"></span></button> <button type="button" aria-label="tips" class="mobile-dropdown-title"><span class="title">tips</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./tips/url-mode.html" class="nav-link">
  urlæ¨¡å¼
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ’ä»¶" class="dropdown-title"><span class="title">æ’ä»¶</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ’ä»¶" class="mobile-dropdown-title"><span class="title">æ’ä»¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./plugins/plugin.html" class="nav-link">
  æ’ä»¶åˆ†äº«
</a></li></ul></div></div><div class="nav-item"><a href="/./vue2/prepare/" class="nav-link">
  vue2.x
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue3.x" class="dropdown-title"><span class="title">vue3.x</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue3.x" class="mobile-dropdown-title"><span class="title">vue3.x</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./vue3/essence-of-comp.html" class="nav-link">
  ç»„ä»¶çš„æœ¬è´¨
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/vnode.html" class="nav-link">
  æŠŠVNodeè§£å‰–ä¸€ä¸‹
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/h.html" class="nav-link">
  è¾…åŠ©åˆ›å»º VNode çš„ h å‡½æ•°
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/observer.html" class="nav-link">
  å“åº”å¼åŸç†
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/renderer.html" class="nav-link">
  æ¸²æŸ“å™¨ä¹‹æŒ‚è½½
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/renderer-patch.html" class="nav-link">
  æ¸²æŸ“å™¨ä¹‹patch
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/renderer-diff.html" class="nav-link">
  æ¸²æŸ“å™¨çš„æ ¸å¿ƒ Diff ç®—æ³•
</a></li><li class="dropdown-item"><!----> <a href="/./vue3/renderer-advanced.html" class="nav-link">
  è‡ªå®šä¹‰æ¸²æŸ“å™¨
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯å…«è‚¡æ–‡" class="dropdown-title"><span class="title">å‰ç«¯å…«è‚¡æ–‡</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯å…«è‚¡æ–‡" class="mobile-dropdown-title"><span class="title">å‰ç«¯å…«è‚¡æ–‡</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./basic/basic.html" class="nav-link">
  å…«è‚¡æ–‡
</a></li><li class="dropdown-item"><!----> <a href="/./basic/arithmetic.html" class="nav-link">
  ç®—æ³•
</a></li><li class="dropdown-item"><!----> <a href="/./basic/desinmode.html" class="nav-link">
  è®¾è®¡æ¨¡å¼
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="é¢è¯•ç»éªŒ" class="dropdown-title"><span class="title">é¢è¯•ç»éªŒ</span> <span class="arrow down"></span></button> <button type="button" aria-label="é¢è¯•ç»éªŒ" class="mobile-dropdown-title"><span class="title">é¢è¯•ç»éªŒ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/./interview/interview.html" class="nav-link">
  é¢è¯•ç»éªŒ
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å‡†å¤‡å·¥ä½œ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./vue2/prepare/" class="sidebar-link">Introduction</a></li><li><a href="/./vue2/prepare/flow.html" class="sidebar-link">è®¤è¯† Flow</a></li><li><a href="/./vue2/prepare/directory.html" class="sidebar-link">Vue.js æºç ç›®å½•è®¾è®¡</a></li><li><a href="/./vue2/prepare/build.html" class="sidebar-link">Vue.js æºç æ„å»º</a></li><li><a href="/./vue2/prepare/entrance.html" class="sidebar-link">ä»å…¥å£å¼€å§‹</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æ•°æ®é©±åŠ¨</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./vue2/data-driven/" class="sidebar-link">Introduction</a></li><li><a href="/./vue2/data-driven/new-vue.html" class="sidebar-link">new Vue å‘ç”Ÿäº†ä»€ä¹ˆ</a></li><li><a href="/./vue2/data-driven/mounted.html" class="sidebar-link">Vue å®ä¾‹æŒ‚è½½çš„å®ç°</a></li><li><a href="/./vue2/data-driven/render.html" class="sidebar-link">render</a></li><li><a href="/./vue2/data-driven/virtual-dom.html" class="sidebar-link">Virtual DOM</a></li><li><a href="/./vue2/data-driven/create-element.html" class="sidebar-link">createElement</a></li><li><a href="/./vue2/data-driven/update.html" class="sidebar-link">update</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç»„ä»¶åŒ–</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./vue2/components/" class="sidebar-link">Introduction</a></li><li><a href="/./vue2/components/create-component.html" class="sidebar-link">createComponent</a></li><li><a href="/./vue2/components/patch.html" class="sidebar-link">patch</a></li><li><a href="/./vue2/components/merge-option.html" class="sidebar-link">åˆå¹¶é…ç½®</a></li><li><a href="/./vue2/components/lifecycle.html" class="sidebar-link">ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="/./vue2/components/component-register.html" class="sidebar-link">ç»„ä»¶æ³¨å†Œ</a></li><li><a href="/./vue2/components/async-component.html" class="sidebar-link">å¼‚æ­¥ç»„ä»¶</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æ·±å…¥å“åº”å¼åŸç†</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./vue2/reactive/" class="sidebar-link">Introduction</a></li><li><a href="/./vue2/reactive/reactive-object.html" class="sidebar-link">å“åº”å¼å¯¹è±¡</a></li><li><a href="/./vue2/reactive/getters.html" class="sidebar-link">ä¾èµ–æ”¶é›†</a></li><li><a href="/./vue2/reactive/setters.html" class="sidebar-link">æ´¾å‘æ›´æ–°</a></li><li><a href="/./vue2/reactive/next-tick.html" class="sidebar-link">nextTick</a></li><li><a href="/./vue2/reactive/questions.html" class="sidebar-link">æ£€æµ‹å˜åŒ–çš„æ³¨æ„äº‹é¡¹</a></li><li><a href="/./vue2/reactive/computed-watcher.html" class="sidebar-link">è®¡ç®—å±æ€§ VS ä¾¦å¬å±æ€§</a></li><li><a href="/./vue2/reactive/component-update.html" class="sidebar-link">ç»„ä»¶æ›´æ–°</a></li><li><a href="/./vue2/reactive/props.html" class="sidebar-link">Props (v2.6.11)</a></li><li><a href="/./vue2/reactive/summary.html" class="sidebar-link">åŸç†å›¾</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ç¼–è¯‘</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./vue2/compile/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/./vue2/compile/entrance.html" class="sidebar-link">ç¼–è¯‘å…¥å£</a></li><li><a href="/./vue2/compile/parse.html" class="sidebar-link">parse</a></li><li><a href="/./vue2/compile/optimize.html" aria-current="page" class="active sidebar-link">optimize</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./vue2/compile/optimize.html#æ ‡è®°é™æ€èŠ‚ç‚¹" class="sidebar-link">æ ‡è®°é™æ€èŠ‚ç‚¹</a></li><li class="sidebar-sub-header"><a href="/./vue2/compile/optimize.html#æ ‡è®°é™æ€æ ¹" class="sidebar-link">æ ‡è®°é™æ€æ ¹</a></li><li class="sidebar-sub-header"><a href="/./vue2/compile/optimize.html#æ€»ç»“" class="sidebar-link">æ€»ç»“</a></li></ul></li><li><a href="/./vue2/compile/codegen.html" class="sidebar-link">codegen</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æ‰©å±•</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./vue2/extend/" class="sidebar-link">Introduction</a></li><li><a href="/./vue2/extend/event.html" class="sidebar-link">event</a></li><li><a href="/./vue2/extend/v-model.html" class="sidebar-link">v-model</a></li><li><a href="/./vue2/extend/slot.html" class="sidebar-link">slot</a></li><li><a href="/./vue2/extend/keep-alive.html" class="sidebar-link">keep-alive</a></li><li><a href="/./vue2/extend/tansition.html" class="sidebar-link">transition</a></li><li><a href="/./vue2/extend/tansition-group.html" class="sidebar-link">transition-group</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue Router</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./vue2/vue-router/" class="sidebar-link">Introduction</a></li><li><a href="/./vue2/vue-router/install.html" class="sidebar-link">è·¯ç”±æ³¨å†Œ</a></li><li><a href="/./vue2/vue-router/router.html" class="sidebar-link">VueRouter å¯¹è±¡</a></li><li><a href="/./vue2/vue-router/matcher.html" class="sidebar-link">matcher</a></li><li><a href="/./vue2/vue-router/transition-to.html" class="sidebar-link">è·¯å¾„åˆ‡æ¢</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vuex</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./vue2/vuex/" class="sidebar-link">Introduction</a></li><li><a href="/./vue2/vuex/init.html" class="sidebar-link">Vuex åˆå§‹åŒ–</a></li><li><a href="/./vue2/vuex/api.html" class="sidebar-link">API</a></li><li><a href="/./vue2/vuex/plugin.html" class="sidebar-link">æ’ä»¶</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="optimize"><a href="#optimize" class="header-anchor">#</a> optimize</h1> <p>å½“æˆ‘ä»¬çš„æ¨¡æ¿ <code>template</code> ç»è¿‡ <code>parse</code> è¿‡ç¨‹åï¼Œä¼šè¾“å‡ºç”Ÿæˆ AST æ ‘ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¯¹è¿™é¢—æ ‘åšä¼˜åŒ–ï¼Œ<code>optimize</code> çš„é€»è¾‘æ˜¯è¿œç®€å•äº <code>parse</code> çš„é€»è¾‘ï¼Œæ‰€ä»¥ç†è§£èµ·æ¥ä¼šè½»æ¾å¾ˆå¤šã€‚</p> <p>ä¸ºä»€ä¹ˆè¦æœ‰ä¼˜åŒ–è¿‡ç¨‹ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“ Vue æ˜¯æ•°æ®é©±åŠ¨ï¼Œæ˜¯å“åº”å¼çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ¨¡æ¿å¹¶ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½æ˜¯å“åº”å¼çš„ï¼Œä¹Ÿæœ‰å¾ˆå¤šæ•°æ®æ˜¯é¦–æ¬¡æ¸²æŸ“åå°±æ°¸è¿œä¸ä¼šå˜åŒ–çš„ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†æ•°æ®ç”Ÿæˆçš„ DOM ä¹Ÿä¸ä¼šå˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>patch</code> çš„è¿‡ç¨‹è·³è¿‡å¯¹ä»–ä»¬çš„æ¯”å¯¹ã€‚</p> <p>æ¥çœ‹ä¸€ä¸‹ <code>optimize</code> æ–¹æ³•çš„å®šä¹‰ï¼Œåœ¨ <code>src/compiler/optimizer.js</code> ä¸­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Goal of the optimizer: walk the generated template AST tree
 * and detect sub-trees that are purely static, i.e. parts of
 * the DOM that never needs to change.
 *
 * Once we detect these sub-trees, we can:
 *
 * 1. Hoist them into constants, so that we no longer need to
 *    create fresh nodes for them on each re-render;
 * 2. Completely skip them in the patching process.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">optimize</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token operator">?</span>ASTElement<span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> CompilerOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token keyword">return</span>
  isStaticKey <span class="token operator">=</span> <span class="token function">genStaticKeysCached</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>staticKeys <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span>
  isPlatformReservedTag <span class="token operator">=</span> options<span class="token punctuation">.</span>isReservedTag <span class="token operator">||</span> no
  <span class="token comment">// first pass: mark all non-static nodes.</span>
  <span class="token function">markStatic</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
  <span class="token comment">// second pass: mark static roots.</span>
  <span class="token function">markStaticRoots</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">genStaticKeys</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">keys</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>
    <span class="token string">'type,tag,attrsList,attrsMap,plain,parent,children,attrs'</span> <span class="token operator">+</span>
    <span class="token punctuation">(</span>keys <span class="token operator">?</span> <span class="token string">','</span> <span class="token operator">+</span> keys <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬åœ¨ç¼–è¯‘é˜¶æ®µå¯ä»¥æŠŠä¸€äº› AST èŠ‚ç‚¹ä¼˜åŒ–æˆé™æ€èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ•´ä¸ª <code>optimize</code> çš„è¿‡ç¨‹å®é™…ä¸Šå°±å¹² 2 ä»¶äº‹æƒ…ï¼Œ<code>markStatic(root)</code> æ ‡è®°é™æ€èŠ‚ç‚¹ ï¼Œ<code>markStaticRoots(root, false)</code> æ ‡è®°é™æ€æ ¹ã€‚</p> <h2 id="æ ‡è®°é™æ€èŠ‚ç‚¹"><a href="#æ ‡è®°é™æ€èŠ‚ç‚¹" class="header-anchor">#</a> æ ‡è®°é™æ€èŠ‚ç‚¹</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">markStatic</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> ASTNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  node<span class="token punctuation">.</span>static <span class="token operator">=</span> <span class="token function">isStatic</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do not make component slot content static. this avoids</span>
    <span class="token comment">// 1. components not able to mutate slot nodes</span>
    <span class="token comment">// 2. static slot content fails for hot-reloading</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      <span class="token operator">!</span><span class="token function">isPlatformReservedTag</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      node<span class="token punctuation">.</span>tag <span class="token operator">!==</span> <span class="token string">'slot'</span> <span class="token operator">&amp;&amp;</span>
      node<span class="token punctuation">.</span>attrsMap<span class="token punctuation">[</span><span class="token string">'inline-template'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> child <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token function">markStatic</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>child<span class="token punctuation">.</span>static<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>static <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> l <span class="token operator">=</span> node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> block <span class="token operator">=</span> node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>block
        <span class="token function">markStatic</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>block<span class="token punctuation">.</span>static<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          node<span class="token punctuation">.</span>static <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">isStatic</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> ASTNode</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// expression</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// text</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>pre <span class="token operator">||</span> <span class="token punctuation">(</span>
    <span class="token operator">!</span>node<span class="token punctuation">.</span>hasBindings <span class="token operator">&amp;&amp;</span> <span class="token comment">// no dynamic bindings</span>
    <span class="token operator">!</span>node<span class="token punctuation">.</span>if <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>node<span class="token punctuation">.</span>for <span class="token operator">&amp;&amp;</span> <span class="token comment">// not v-if or v-for or v-else</span>
    <span class="token operator">!</span><span class="token function">isBuiltInTag</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// not a built-in</span>
    <span class="token function">isPlatformReservedTag</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">// not a component</span>
    <span class="token operator">!</span><span class="token function">isDirectChildOfTemplateFor</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>isStaticKey<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é¦–å…ˆæ‰§è¡Œ <code>node.static = isStatic(node)</code></p> <p><code>isStatic</code> æ˜¯å¯¹ä¸€ä¸ª AST å…ƒç´ èŠ‚ç‚¹æ˜¯å¦æ˜¯é™æ€çš„åˆ¤æ–­ï¼Œå¦‚æœæ˜¯è¡¨è¾¾å¼ï¼Œå°±æ˜¯éé™æ€ï¼›å¦‚æœæ˜¯çº¯æ–‡æœ¬ï¼Œå°±æ˜¯é™æ€ï¼›å¯¹äºä¸€ä¸ªæ™®é€šå…ƒç´ ï¼Œå¦‚æœæœ‰ pre å±æ€§ï¼Œé‚£ä¹ˆå®ƒä½¿ç”¨äº† <code>v-pre</code> æŒ‡ä»¤ï¼Œæ˜¯é™æ€ï¼Œå¦åˆ™è¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼šæ²¡æœ‰ä½¿ç”¨ <code>v-if</code>ã€<code>v-for</code>ï¼Œæ²¡æœ‰ä½¿ç”¨å…¶å®ƒæŒ‡ä»¤ï¼ˆä¸åŒ…æ‹¬ <code>v-once</code>ï¼‰ï¼Œéå†…ç½®ç»„ä»¶ï¼Œæ˜¯å¹³å°ä¿ç•™çš„æ ‡ç­¾ï¼Œéå¸¦æœ‰ <code>v-for</code> çš„ <code>template</code> æ ‡ç­¾çš„ç›´æ¥å­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§çš„ <code>key</code> éƒ½æ»¡è¶³é™æ€ keyï¼›è¿™äº›éƒ½æ»¡è¶³åˆ™è¿™ä¸ª AST èŠ‚ç‚¹æ˜¯ä¸€ä¸ªé™æ€èŠ‚ç‚¹ã€‚</p> <p>å¦‚æœè¿™ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ™®é€šå…ƒç´ ï¼Œåˆ™éå†å®ƒçš„æ‰€æœ‰ <code>children</code>ï¼Œé€’å½’æ‰§è¡Œ <code>markStatic</code>ã€‚å› ä¸ºæ‰€æœ‰çš„ <code>elseif</code> å’Œ <code>else</code> èŠ‚ç‚¹éƒ½ä¸åœ¨ <code>children</code> ä¸­ï¼Œ å¦‚æœèŠ‚ç‚¹çš„ <code>ifConditions</code> ä¸ä¸ºç©ºï¼Œåˆ™éå† <code>ifConditions</code> æ‹¿åˆ°æ‰€æœ‰æ¡ä»¶ä¸­çš„ <code>block</code>ï¼Œä¹Ÿå°±æ˜¯å®ƒä»¬å¯¹åº”çš„ AST èŠ‚ç‚¹ï¼Œé€’å½’æ‰§è¡Œ <code>markStatic</code>ã€‚åœ¨è¿™äº›é€’å½’è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å­èŠ‚ç‚¹æœ‰ä¸æ˜¯ <code>static</code> çš„æƒ…å†µï¼Œåˆ™å®ƒçš„çˆ¶èŠ‚ç‚¹çš„ <code>static</code> å‡å˜æˆ falseã€‚</p> <h2 id="æ ‡è®°é™æ€æ ¹"><a href="#æ ‡è®°é™æ€æ ¹" class="header-anchor">#</a> æ ‡è®°é™æ€æ ¹</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">markStaticRoots</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> ASTNode<span class="token punctuation">,</span> <span class="token literal-property property">isInFor</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>static <span class="token operator">||</span> node<span class="token punctuation">.</span>once<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>staticInFor <span class="token operator">=</span> isInFor
    <span class="token punctuation">}</span>
    <span class="token comment">// For a node to qualify as a static root, it should have children that</span>
    <span class="token comment">// are not just static text. Otherwise the cost of hoisting out will</span>
    <span class="token comment">// outweigh the benefits and it's better off to just always render it fresh.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>static <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>
      node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span>
      node<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>staticRoot <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>staticRoot <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">markStaticRoots</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> isInFor <span class="token operator">||</span> <span class="token operator">!</span><span class="token operator">!</span>node<span class="token punctuation">.</span>for<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> l <span class="token operator">=</span> node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">markStaticRoots</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>ifConditions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>block<span class="token punctuation">,</span> isInFor<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>markStaticRoots</code> ç¬¬äºŒä¸ªå‚æ•°æ˜¯ <code>isInFor</code>ï¼Œå¯¹äºå·²ç»æ˜¯ <code>static</code> çš„èŠ‚ç‚¹æˆ–è€…æ˜¯ <code>v-once</code> æŒ‡ä»¤çš„èŠ‚ç‚¹ï¼Œ<code>node.staticInFor = isInFor</code>ã€‚
æ¥ç€å°±æ˜¯å¯¹äº <code>staticRoot</code> çš„åˆ¤æ–­é€»è¾‘ï¼Œä»æ³¨é‡Šä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºæœ‰èµ„æ ¼æˆä¸º <code>staticRoot</code> çš„èŠ‚ç‚¹ï¼Œé™¤äº†æœ¬èº«æ˜¯ä¸€ä¸ªé™æ€èŠ‚ç‚¹å¤–ï¼Œå¿…é¡»æ»¡è¶³æ‹¥æœ‰ <code>children</code>ï¼Œå¹¶ä¸” <code>children</code> ä¸èƒ½åªæ˜¯ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œä¸ç„¶çš„è¯æŠŠå®ƒæ ‡è®°æˆé™æ€æ ¹èŠ‚ç‚¹çš„æ”¶ç›Šå°±å¾ˆå°äº†ã€‚</p> <p>æ¥ä¸‹æ¥å’Œæ ‡è®°é™æ€èŠ‚ç‚¹çš„é€»è¾‘ä¸€æ ·ï¼Œéå† <code>children</code> ä»¥åŠ <code>ifConditions</code>ï¼Œé€’å½’æ‰§è¡Œ <code>markStaticRoots</code>ã€‚</p> <p>å›å½’æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­ï¼Œç»è¿‡ <code>optimize</code> åï¼ŒAST æ ‘å˜æˆäº†å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'type'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string-property property">'tag'</span><span class="token operator">:</span> <span class="token string">'ul'</span><span class="token punctuation">,</span>
  <span class="token string-property property">'attrsList'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">'attrsMap'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">':class'</span><span class="token operator">:</span> <span class="token string">'bindCls'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'class'</span><span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'v-if'</span><span class="token operator">:</span> <span class="token string">'isShow'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">'if'</span><span class="token operator">:</span> <span class="token string">'isShow'</span><span class="token punctuation">,</span>
  <span class="token string-property property">'ifConditions'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token string-property property">'exp'</span><span class="token operator">:</span> <span class="token string">'isShow'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'block'</span><span class="token operator">:</span> <span class="token comment">// ul ast element</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">'parent'</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  <span class="token string-property property">'plain'</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token string-property property">'staticClass'</span><span class="token operator">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
  <span class="token string-property property">'classBinding'</span><span class="token operator">:</span> <span class="token string">'bindCls'</span><span class="token punctuation">,</span>
  <span class="token string-property property">'static'</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token string-property property">'staticRoot'</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token string-property property">'children'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token string-property property">'type'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string-property property">'tag'</span><span class="token operator">:</span> <span class="token string">'li'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'attrsList'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string-property property">'name'</span><span class="token operator">:</span> <span class="token string">'@click'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'value'</span><span class="token operator">:</span> <span class="token string">'clickItem(index)'</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">'attrsMap'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'@click'</span><span class="token operator">:</span> <span class="token string">'clickItem(index)'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'v-for'</span><span class="token operator">:</span> <span class="token string">'(item,index) in data'</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">'parent'</span><span class="token operator">:</span> <span class="token comment">// ul ast element</span>
    <span class="token string-property property">'plain'</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">'events'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'click'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'value'</span><span class="token operator">:</span> <span class="token string">'clickItem(index)'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">'hasBindings'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">'for'</span><span class="token operator">:</span> <span class="token string">'data'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'alias'</span><span class="token operator">:</span> <span class="token string">'item'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'iterator1'</span><span class="token operator">:</span> <span class="token string">'index'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'static'</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">'staticRoot'</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">'children'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string-property property">'type'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token string-property property">'expression'</span><span class="token operator">:</span> <span class="token string">'_s(item)+&quot;:&quot;+_s(index)'</span>
      <span class="token string-property property">'text'</span><span class="token operator">:</span> <span class="token string">'{{item}}:{{index}}'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'tokens'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string-property property">'@binding'</span><span class="token operator">:</span><span class="token string">'item'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">':'</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string-property property">'@binding'</span><span class="token operator">:</span><span class="token string">'index'</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">'static'</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬å‘ç°æ¯ä¸€ä¸ª AST å…ƒç´ èŠ‚ç‚¹éƒ½å¤šäº† <code>staic</code> å±æ€§ï¼Œå¹¶ä¸” <code>type</code> ä¸º 1 çš„æ™®é€šå…ƒç´  AST èŠ‚ç‚¹å¤šäº† <code>staticRoot</code> å±æ€§ã€‚</p> <h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p>é‚£ä¹ˆè‡³æ­¤æˆ‘ä»¬åˆ†æå®Œäº† <code>optimize</code> çš„è¿‡ç¨‹ï¼Œå°±æ˜¯æ·±åº¦éå†è¿™ä¸ª AST æ ‘ï¼Œå»æ£€æµ‹å®ƒçš„æ¯ä¸€é¢—å­æ ‘æ˜¯ä¸æ˜¯é™æ€èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯é™æ€èŠ‚ç‚¹åˆ™å®ƒä»¬ç”Ÿæˆ DOM æ°¸è¿œä¸éœ€è¦æ”¹å˜ï¼Œè¿™å¯¹è¿è¡Œæ—¶å¯¹æ¨¡æ¿çš„æ›´æ–°èµ·åˆ°æå¤§çš„ä¼˜åŒ–ä½œç”¨ã€‚</p> <p>æˆ‘ä»¬é€šè¿‡ <code>optimize</code> æˆ‘ä»¬æŠŠæ•´ä¸ª AST æ ‘ä¸­çš„æ¯ä¸€ä¸ª AST å…ƒç´ èŠ‚ç‚¹æ ‡è®°äº† <code>static</code> å’Œ <code>staticRoot</code>ï¼Œå®ƒä¼šå½±å“æˆ‘ä»¬æ¥ä¸‹æ¥æ‰§è¡Œä»£ç ç”Ÿæˆçš„è¿‡ç¨‹ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/./vue2/compile/parse.html" class="prev">
        parse
      </a></span> <span class="next"><a href="/./vue2/compile/codegen.html">
        codegen
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.c50cae2e.js" defer></script><script src="./assets/js/4.08095b6d.js" defer></script><script src="./assets/js/33.e00e1922.js" defer></script>
  </body>
</html>
